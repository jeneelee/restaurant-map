<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ëª¨ë‘ì˜ë§›ì§‘ ì§€ë„</title>


  <style>
    body { margin: 0; }
    #map {
      height: 80vh;
      width: 100%;
    }
    .buttons {
      padding: 10px;
    }
    button {
      padding: 8px 12px;
      margin-right: 10px;
      cursor: pointer;
    }
  </style>

  <!-- âœ… ë°˜ë“œì‹œ ë„¤ì´ë²„í´ë¼ìš°ë“œ Maps JavaScriptìš© Client ID -->
  <script
    type="text/javascript"
    src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=0a2uj6ehjv">
  </script>
</head>

<body>

<h2>ëª¨ë‘ì˜ë§›ì§‘! ì§€ë„</h2>

<div class="buttons">
  <button onclick="showBySource('ë¯¸ìŠë­')">ë¯¸ìŠë­</button>
  <button onclick="showBySource('ë§›ìˆëŠ”ë…€ì„ë“¤')">ë§›ìˆëŠ”ë…€ì„ë“¤</button>
</div>

<div id="map"></div>

<script>
let map;
let markers = [];
let allData = [];

window.onload = function() {
  initMap();
};

function initMap() {
  map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(37.5665, 126.9780),
    zoom: 12
  });

  loadData();
}

function loadData() {
  fetch("https://opensheet.elk.sh/1zNSdIdZeJuUrD56NbYCdby7QGfoRMC-WzGsLHjpKLlo/ì‹œíŠ¸1")
    .then(res => res.json())
    .then(data => {
      allData = data;
      console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ", allData);
    })
    .catch(err => {
      console.error("ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨:", err);
    });
}

function clearMarkers() {
  markers.forEach(m => m.setMap(null));
  markers = [];
}

function showBySource(type) {

  if (!allData.length) {
    alert("ë°ì´í„° ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
    return;
  }

  clearMarkers();

  // ğŸ” source ì»¬ëŸ¼ ìœ ì—° ì²˜ë¦¬
  const getSource = (item) =>
    item.source ?? item.Source ?? item["ì¶œì²˜"];

  const filtered = allData.filter(item => getSource(item) === type);

  filtered.forEach(place => {

    const lat = parseFloat(place.lat);
    const lng = parseFloat(place.lng);

    if (Number.isNaN(lat) || Number.isNaN(lng)) return;

    const marker = new naver.maps.Marker({
      position: new naver.maps.LatLng(lat, lng),
      map: map,
      title: place.name
    });

    const infoWindow = new naver.maps.InfoWindow({
      content: `
        <div style="padding:10px;">
          <strong>${place.name}</strong><br>
          ì¶œì²˜: ${getSource(place)}
        </div>
      `
    });

    naver.maps.Event.addListener(marker, "click", function() {
      infoWindow.open(map, marker);
    });

    markers.push(marker);
  });

  if (!filtered.length) {
    console.warn("í•„í„° ê²°ê³¼ ì—†ìŒ. ì‹œíŠ¸ ì»¬ëŸ¼ëª… í™•ì¸ í•„ìš”.");
  }
}
</script>

</body>
</html>
